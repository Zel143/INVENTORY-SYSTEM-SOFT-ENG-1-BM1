<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockSense | Dashboard (SQLite)</title>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Dashboard Styles -->
    <link rel="stylesheet" href="dashboard.css">
</head>
<body>
    <!-- Notification Banner -->
    <div id="notification-banner" class="notification-banner" style="display:none;"
         onclick="hideBanner()"></div>

    <!-- Loading Spinner (UAT ID 29) -->
    <div id="loading-spinner" class="loading-overlay" style="display: none;">
        <div class="spinner">
            <i class="fas fa-circle-notch fa-spin"></i>
            <p>Loading...</p>
        </div>
    </div>

    <!-- Navigation Bar -->
    <header class="navbar">
        <div class="nav-brand">
            <h1>üì¶ StockSense</h1>
            <span class="version-badge">SQLite Edition</span>
        </div>
        <div class="nav-actions">
            <!-- User Display -->
            <div class="user-display">
                <span id="user-name">Loading...</span>
                <span id="user-role" class="user-role-badge">-</span>
            </div>

            <!-- Theme Toggle -->
            <label class="theme-toggle">
                <input type="checkbox" id="theme-toggle">
                <span class="slider"></span>
            </label>

            <!-- Logout -->
            <button class="btn-logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="tabs">
        <div class="nav-item active" onclick="switchTab('tracker', this)">
            <i class="fas fa-exclamation-triangle"></i> Stock Alerts
        </div>
        <div class="nav-item" onclick="switchTab('inventory', this)">
            <i class="fas fa-box"></i> Full Inventory
        </div>
        <div class="nav-item" onclick="switchTab('history', this)">
            <i class="fas fa-history"></i> Transaction History
        </div>
    </nav>

    <!-- SECTION 1: Stock Alerts (Low Stock Tracker) -->
    <section id="view-tracker" class="view-section" style="display:block;">
        <div class="section-header">
            <h2>‚ö†Ô∏è Stock Alerts</h2>
            <p class="section-subtitle">Items below minimum threshold</p>
        </div>
        <div id="tracker-grid" class="tracker-grid">
            <!-- Low stock items will be rendered here -->
        </div>
    </section>

    <!-- SECTION 2: Full Inventory -->
    <section id="view-inventory" class="view-section" style="display:none;">
        <div class="section-header section-header-row">
            <div>
                <h2>üì¶ Full Inventory</h2>
                <p class="section-subtitle">All items in warehouse</p>
            </div>
            <div class="header-actions">
                <button id="add-item-btn" class="btn-add-item" onclick="openAddItemModal()" style="display:none;">
                    <i class="fas fa-plus"></i> Log New Stock
                </button>
                <input
                    type="text"
                    id="search-box"
                    placeholder="üîç Search items..."
                    onkeyup="handleSearch(this.value)"
                >
            </div>
        </div>

        <div class="table-container">
            <table class="inventory-table">
                <thead>
                    <tr>
                        <th class="sortable" data-column="description" onclick="sortTable('description')">Item <i class="fas fa-sort sort-icon"></i></th>
                        <th class="sortable" data-column="code" onclick="sortTable('code')">Code <i class="fas fa-sort sort-icon"></i></th>
                        <th class="sortable" data-column="vendor" onclick="sortTable('vendor')">Vendor <i class="fas fa-sort sort-icon"></i></th>
                        <th class="sortable" data-column="current_stock" onclick="sortTable('current_stock')">Stock <i class="fas fa-sort sort-icon"></i></th>
                        <th class="sortable" data-column="min_threshold" onclick="sortTable('min_threshold')">Min. Threshold <i class="fas fa-sort sort-icon"></i></th>
                        <th class="sortable" data-column="storage_location" onclick="sortTable('storage_location')">Location <i class="fas fa-sort sort-icon"></i></th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Inventory rows will be rendered here -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- SECTION 3: Transaction History -->
    <section id="view-history" class="view-section" style="display:none;">
        <div class="section-header">
            <h2>üìú Transaction History</h2>
            <p class="section-subtitle">
                <span class="info-badge">üîí Admin Only</span>
                Immutable audit trail
            </p>
        </div>

        <div class="table-container">
            <table class="inventory-table" id="history-table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Item</th>
                        <th>Actor</th>
                        <th>Change</th>
                        <th>Stock Level</th>
                        <th>Destination</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Transaction history will be rendered here -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- MODAL: Transaction Form -->
    <div id="transModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeTransModal()">&times;</span>
            <h2 id="modal-title">Stock Transaction</h2>
            
            <p style="margin: 1rem 0; color: #64748b;">
                Item: <strong id="modal-item-display">-</strong>
            </p>

            <!-- Available stock info ‚Äî shows reserved vs available for dispatch -->
            <div id="modal-stock-info" class="modal-stock-info"></div>

            <form id="transForm">
                <div class="form-group">
                    <label>Quantity:</label>
                    <input 
                        type="number" 
                        id="quantity" 
                        min="1" 
                        required 
                        placeholder="Enter quantity"
                        class="form-input"
                    >
                </div>

                <div class="form-group">
                    <label>Destination:</label>
                    <input 
                        type="text" 
                        id="destination" 
                        placeholder="e.g., Production Floor, Bin A-5"
                        class="form-input"
                    >
                </div>

                <div class="form-group">
                    <label>Purpose:</label>
                    <textarea 
                        id="purpose" 
                        placeholder="Reason for transaction"
                        class="form-input"
                        rows="3"
                    ></textarea>
                </div>

                <button type="submit" class="btn-submit">Submit</button>
            </form>
        </div>
    </div>

    <!-- MODAL: Log New Stock (Admin only) -->
    <div id="addItemModal" class="modal">
        <div class="modal-content modal-content-wide">
            <span class="close" onclick="closeAddItemModal()">&times;</span>
            <h2>Log New Stock</h2>
            <form id="addItemForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Item Code <span class="required">*</span></label>
                        <input type="text" id="new-code" class="form-input"
                               placeholder="e.g., MCH-005" required>
                    </div>
                    <div class="form-group">
                        <label>Vendor</label>
                        <input type="text" id="new-vendor" class="form-input"
                               placeholder="Vendor name">
                    </div>
                </div>

                <div class="form-group">
                    <label>Description <span class="required">*</span></label>
                    <input type="text" id="new-description" class="form-input"
                           placeholder="Full item description" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Date Delivered</label>
                        <input type="date" id="new-date-delivered" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Storage Location</label>
                        <input type="text" id="new-location" class="form-input"
                               placeholder="e.g., Bin-A1">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Warranty Start</label>
                        <input type="date" id="new-warranty-start" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Warranty End</label>
                        <input type="date" id="new-warranty-end" class="form-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Starting Stock</label>
                        <input type="number" id="new-stock" class="form-input" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Allocated ‚Äî MA Reserved</label>
                        <input type="number" id="new-allocated" class="form-input" min="0" value="0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Min Threshold</label>
                        <input type="number" id="new-min" class="form-input" min="0" value="5">
                    </div>
                    <div class="form-group">
                        <label>Max Ceiling</label>
                        <input type="number" id="new-max" class="form-input" min="0" value="20">
                    </div>
                </div>

                <button type="submit" class="btn-submit">Add Item</button>
            </form>
        </div>
    </div>

    <!-- SQLite Application Logic -->
    <script src="app-sqlite.js"></script>
</body>
</html>
