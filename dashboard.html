<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockSense | Dashboard</title>
    
    <!-- Firebase SDKs (v9.22.0 compat mode) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Dashboard Styles -->
    <link rel="stylesheet" href="dashboard.css">
</head>
<body>
    <!-- Navigation Bar -->
    <header class="navbar">
        <div class="nav-brand">
            <h1>üè≠ StockSense</h1>
            <span class="version-badge">Cloud Edition</span>
        </div>
        <div class="nav-actions">
            <span class="user-display">
                <i class="fas fa-user-circle"></i>
                <span id="user-name"></span>
                <span class="user-role-badge"></span>
            </span>
            
            <!-- Theme Toggle -->
            <label class="theme-toggle">
                <input type="checkbox" id="checkbox">
                <div class="slider"></div>
            </label>
            
            <button class="btn-logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="tabs">
        <div class="nav-item active" onclick="switchTab('tracker', this)">
            <i class="fas fa-exclamation-triangle"></i> Stock Alerts
        </div>
        <div class="nav-item" onclick="switchTab('inventory', this)">
            <i class="fas fa-boxes"></i> Inventory
        </div>
        <div class="nav-item" onclick="switchTab('history', this)">
            <i class="fas fa-history"></i> Transaction History
        </div>
    </nav>

    <!-- SECTION 1: Stock Alerts (Low Stock Tracker) -->
    <section id="view-tracker" class="view-section" style="display:block;">
        <div class="section-header">
            <h2><i class="fas fa-bell"></i> Critical Stock Alerts</h2>
            <p class="section-subtitle">Items below minimum threshold (Auto-updates in <2 seconds)</p>
        </div>
        <div id="tracker-grid" class="tracker-grid">
            <p class="loading-state"><i class="fas fa-spinner fa-spin"></i> Loading alerts...</p>
        </div>
    </section>

    <!-- SECTION 2: Full Inventory -->
    <section id="view-inventory" class="view-section" style="display:none;">
        <div class="section-header">
            <h2><i class="fas fa-warehouse"></i> Inventory Management</h2>
            <div class="header-actions">
                <input 
                    type="search" 
                    id="search-box" 
                    placeholder="üîç Search by code, name, vendor, or location..." 
                    onkeyup="handleSearch(this.value)"
                >
            </div>
        </div>
        <div class="table-container">
            <table class="inventory-table">
                <thead>
                    <tr>
                        <th>Item Details</th>
                        <th>Status</th>
                        <th>Quantity</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="inventory-list">
                    <tr><td colspan="4" class="loading-state"><i class="fas fa-spinner fa-spin"></i> Loading inventory...</td></tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- SECTION 3: Transaction History -->
    <section id="view-history" class="view-section" style="display:none;">
        <div class="section-header">
            <h2><i class="fas fa-file-alt"></i> Audit Trail</h2>
            <p class="section-subtitle">
                <i class="fas fa-lock"></i> Immutable "Black Box" - Admin Only
                <span class="info-badge" title="Transactions cannot be edited or deleted by anyone, including admins. This enforces audit integrity.">
                    <i class="fas fa-info-circle"></i>
                </span>
            </p>
        </div>
        <div class="table-container">
            <table class="inventory-table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Actor</th>
                        <th>Item</th>
                        <th>Change</th>
                        <th>Destination / Reference</th>
                    </tr>
                </thead>
                <tbody id="history-list">
                    <tr><td colspan="5" class="loading-state"><i class="fas fa-spinner fa-spin"></i> Loading history...</td></tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- MODAL: Transaction Form -->
    <div id="transModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="trans-title">Transaction</h3>
                <button class="modal-close" onclick="closeTransModal()">√ó</button>
            </div>
            <form id="transForm">
                <input type="hidden" id="trans-id">
                
                <div class="form-group">
                    <label for="trans-change">Quantity Change:</label>
                    <input 
                        type="number" 
                        id="trans-change" 
                        required 
                        min="-9999" 
                        max="9999"
                    >
                    <small class="form-hint">Positive for restock, negative for dispatch</small>
                </div>

                <div id="out-logic" style="display:none;">
                    <div class="form-group">
                        <label for="destination">Destination:</label>
                        <input 
                            type="text" 
                            id="destination" 
                            placeholder="e.g., Production Floor A, Customer #1234"
                            required
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="purpose">Purpose / Reference:</label>
                        <input 
                            type="text" 
                            id="purpose" 
                            placeholder="e.g., Production Run #042, Sales Order #789"
                            required
                        >
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeTransModal()">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-check"></i> Confirm Transaction
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase Configuration & Helper Functions -->
    <script src="firebase-config.js"></script>
    
    <!-- Main Application Logic -->
    <script src="app-firebase.js"></script>

    <script>
        // Display user name on load
        document.getElementById('user-name').textContent = 
            sessionStorage.getItem("stocksense_display_name") || "User";
    </script>
</body>
</html>
